{% extends "base.html" %}
{% block content %}
<div class="min-h-screen bg-gray-50 py-10">
  <div class="max-w-6xl mx-auto px-4">

    <h1 class="text-2xl font-bold text-gray-900 mb-6">Statistiques des cartes citoyennes</h1>

    <!-- Filtre actif -->
    {% if filtre and valeur %}
      <p class="mb-4 text-sm text-gray-700">
        Filtré par <span class="font-semibold">{{ filtre|title }}:</span> "{{ valeur }}"
        <a href="{% url 'citoyens_dashboard_stats' %}" 
           class="text-indigo-600 underline ml-2">Réinitialiser</a>
      </p>
    {% endif %}

    <!-- Onglets -->
    <div x-data="{ tab: 'provinces' }">
      <div class="flex border-b mb-6">
        <button @click="tab = 'provinces'" 
                :class="tab === 'provinces' ? 'border-indigo-600 text-indigo-600' : 'text-gray-600 hover:text-indigo-600'"
                class="px-4 py-2 border-b-2 font-medium">
          Provinces
        </button>
        <button @click="tab = 'federations'" 
                :class="tab === 'federations' ? 'border-indigo-600 text-indigo-600' : 'text-gray-600 hover:text-indigo-600'"
                class="px-4 py-2 border-b-2 font-medium">
          Fédérations
        </button>
        <button @click="tab = 'cellules'" 
                :class="tab === 'cellules' ? 'border-indigo-600 text-indigo-600' : 'text-gray-600 hover:text-indigo-600'"
                class="px-4 py-2 border-b-2 font-medium">
          Cellules
        </button>
        <button @click="tab = 'adhesions'" 
                :class="tab === 'adhesions' ? 'border-indigo-600 text-indigo-600' : 'text-gray-600 hover:text-indigo-600'"
                class="px-4 py-2 border-b-2 font-medium">
          Qualité membre
        </button>
      </div>

      <!-- Provinces -->
      <div x-show="tab === 'provinces'" class="space-y-2">
        {% for item in provinces_count %}
          <a href="?filtre=province&valeur={{ item.province }}"
             class="block px-4 py-2 rounded-lg border {% if filtre == 'province' and valeur == item.province %}bg-indigo-600 text-white{% else %}bg-white text-gray-700 hover:bg-indigo-100{% endif %}">
            {{ item.province|default:"-" }} ({{ item.total }})
          </a>
        {% empty %}
          <p class="text-gray-500">Aucune province</p>
        {% endfor %}
      </div>

      <!-- Fédérations -->
      <div x-show="tab === 'federations'" class="space-y-2">
        {% for item in federations_count %}
          <a href="?filtre=federation&valeur={{ item.federation }}"
             class="block px-4 py-2 rounded-lg border {% if filtre == 'federation' and valeur == item.federation %}bg-indigo-600 text-white{% else %}bg-white text-gray-700 hover:bg-indigo-100{% endif %}">
            {{ item.federation|default:"-" }} ({{ item.total }})
          </a>
        {% empty %}
          <p class="text-gray-500">Aucune fédération</p>
        {% endfor %}
      </div>

      <!-- Cellules -->
      <div x-show="tab === 'cellules'" class="space-y-2">
        {% for item in cellules_count %}
          <a href="?filtre=cellule&valeur={{ item.cellule }}"
             class="block px-4 py-2 rounded-lg border {% if filtre == 'cellule' and valeur == item.cellule %}bg-indigo-600 text-white{% else %}bg-white text-gray-700 hover:bg-indigo-100{% endif %}">
            {{ item.cellule|default:"-" }} ({{ item.total }})
          </a>
        {% empty %}
          <p class="text-gray-500">Aucune cellule</p>
        {% endfor %}
      </div>

      <!-- Adhésions -->
      <div x-show="tab === 'adhesions'" class="space-y-2">
        {% for item in statut_adhesion_count %}
          <a href="?filtre=statut_adhesion&valeur={{ item.statut_adhesion }}"
             class="block px-4 py-2 rounded-lg border {% if filtre == 'statut_adhesion' and valeur == item.statut_adhesion %}bg-indigo-600 text-white{% else %}bg-white text-gray-700 hover:bg-indigo-100{% endif %}">
            {{ item.statut_adhesion|title }} ({{ item.total }})
          </a>
        {% empty %}
          <p class="text-gray-500">Aucune adhésion</p>
        {% endfor %}
      </div>
    </div>

    <!-- Total -->
    <p class="mt-6 text-gray-700 font-semibold">
      Total cartes {% if filtre %}filtrées{% endif %}: {{ citoyens_count }}
    </p>

  </div>
</div>

<!-- Alpine.js pour tabs -->
<script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
{% endblock %}
